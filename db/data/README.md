## POSSUM database ingest

Source of truth:

https://docs.google.com/spreadsheets/d/1sWCtxSSzTwjYjhxr1_KVLWG2AnrHwSJf_RWQow7wbH0/edit?gid=1858715798#gid=1858715798

### Ingest pixels, tiles and map

Use: `ingest_tiles_and_map.py`

Insert or update database entries for the obs_id -> tile mapping in the POSSUM survey. These files were provided by Lerato Sebokolodi (mll.sebokolodi@gmail.com). This script expect that you will start from a fresh database with empty tables:

* `tile`
* `associated_tile`
* `field_tile`

It ingests a large number of files, each containing the following sort of information (see below) and uses the information in the filename to indicate which observation. For example, the filename [`EMU-FULL_2317+04B_1.50d.csv`](EMU_full_survey/mapping_1.5deg/EMU-FULL_2317+04B_1.50d.csv) might contain:

```
PIXELS,CRPIX_RA,CRPIX_DEC,CRVAL_RA [deg],CRVAL_DEC [deg]
5307,-2047.0000161903608,-16383.000242855385,345.9375,8.385538647081319
5308,1.0000161903572007,-14335.000210474669,348.75,8.385538647081319
5309,2049.000048571076,-12287.00017809395,351.5625,8.385538647081319
5435,-2047.000016190359,-14335.00021047467,347.34375,7.180755781458282
5436,1.0000161903590197,-12287.000178093953,350.15625,7.180755781458282
5437,2049.000048571078,-10239.000145713235,352.96875,7.180755781458282
5563,-4095.000048571078,-14335.00021047467,345.9375,5.979156796301311
5564,-2047.00001619036,-12287.000178093953,348.75,5.979156796301311
5565,1.0000161903590197,-10239.000145713233,351.5625,5.979156796301311
5566,2049.0000485710775,-8191.000113332515,354.375,5.979156796301311
5690,-6143.000080951798,-14335.00021047467,344.53125,4.780191847199159
5691,-4095.000048571078,-12287.000178093953,347.34375,4.780191847199159
5692,-2047.00001619036,-10239.000145713235,350.15625,4.780191847199159
5693,1.0000161903590197,-8191.000113332515,352.96875,4.780191847199159
5819,-6143.000080951797,-12287.000178093951,345.9375,3.583321698471973
5820,-4095.000048571079,-10239.000145713233,348.75,3.583321698471973
5821,-2047.0000161903595,-8191.000113332515,351.5625,3.583321698471973
5822,1.0000161903590197,-6143.000080951796,354.375,3.583321698471973
5946,-8191.000113332517,-12287.000178093953,344.53125,2.388015463268777
5947,-6143.000080951797,-10239.000145713233,347.34375,2.388015463268777
5948,-4095.000048571079,-8191.000113332515,350.15625,2.388015463268777
5949,-2047.0000161903595,-6143.000080951797,352.96875,2.388015463268777
6075,-8191.000113332515,-10239.000145713233,345.9375,1.1937484371410785
6076,-6143.000080951797,-8191.000113332515,348.75,1.1937484371410785
6077,-4095.000048571078,-6143.000080951796,351.5625,1.1937484371410785;
```

### Update tile-map

A new script (`update_tilemap.py`) for a second request from the POSSUM team. This script will:

* Assume that the observations and pixel (`possum.observation` and `possum.tile` tables respectively) are already populated
* You have two new files for the EMU (band 1) and WALLABY (band 2) tile maps (`possum.associated_tile` and `possum.field_tile` maps)
* The table mapping entries exist and need to be overwritten

An example snippet from this file is provided by Cameron Van Eck (cameron.vaneck@anu.edu.au):

```
PIXEL,SB1,SB2,SB3,SB4,SB5,SB6,SB7,SB8,SB9,SB10
5184,2359+04A,2359+04B,,,,,,,,
5185,2359+04A,2359+04B,0021+04A,0021+04B,,,,,,
5311,2359+04A,2359+04B,2338+04B,2338+04A,,,,,,
5312,2359+04A,2359+04B,0021+04A,0021+04B,,,,,,
5313,2359+04A,2359+04B,0021+04A,0021+04B,,,,,,
5438,2359+04A,2359+04B,2338+04B,2338+04A,,,,,,
5439,2359+04A,2359+04B,2338+04B,2338+04A,,,,,,
5440,2359+04A,2359+04B,0021+04A,0021+04B,,,,,,
5441,2359+04A,2359+04B,0021+04A,0021+04B,,,,,,
5567,2359+04A,2359+04B,2338+04B,2338+04A,,,,,,
```

This code will (in a transaction):

* Clear the `associated_tile` and `field_tile` tables
* Insert the new entries
* Identify tiles without associated sbids and log them